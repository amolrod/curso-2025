# ==============================================================================
# Configuración de Virtual Host para Apache HTTP Server con PHP
# ==============================================================================
# Compatible con imagen php:8.2-apache
# ==============================================================================

<VirtualHost *:80>
    ServerAdmin admin@example.com
    ServerName localhost
    
    # Directorio raíz
    DocumentRoot /var/www/html
    
    # Configuración de directorios
    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # ==============================================================================
    # CONFIGURACIÓN DE PROXY HACIA TOMCAT
    # ==============================================================================
    
    ProxyRequests Off
    ProxyPreserveHost On
    ProxyTimeout 300
    ProxyIOBufferSize 65536
    
    # ==============================================================================
    # PROXY AJP - Aplicaciones en Tomcat
    # ==============================================================================
    
    # Aplicación demo (vía AJP)
    ProxyPass /demo ajp://tomcat:8009/demo
    ProxyPassReverse /demo ajp://tomcat:8009/demo
    
    # Aplicación Formulario (vía AJP)
    ProxyPass /Formulario ajp://tomcat:8009/Formulario
    ProxyPassReverse /Formulario ajp://tomcat:8009/Formulario
    
    # Examples de Tomcat (vía AJP)
    ProxyPass /examples ajp://tomcat:8009/examples
    ProxyPassReverse /examples ajp://tomcat:8009/examples
    
    # ==============================================================================
    # PROXY HTTP - Tomcat Demo Proxy (puerto 8082)
    # ==============================================================================
    # Este es el proxy HTTP según el documento académico
    
    ProxyPass /tomcat-demo-proxy http://tomcat:8082/demo/
    ProxyPassReverse /tomcat-demo-proxy http://tomcat:8082/demo/
    
    # ==============================================================================
    # TOMCAT MANAGER (vía AJP)
    # ==============================================================================
    
    <Location /manager>
        ProxyPass ajp://tomcat:8009/manager
        ProxyPassReverse ajp://tomcat:8009/manager
        Order allow,deny
        Allow from all
    </Location>
    
    <Location /host-manager>
        ProxyPass ajp://tomcat:8009/host-manager
        ProxyPassReverse ajp://tomcat:8009/host-manager
        Order allow,deny
        Allow from all
    </Location>
    
    # ==============================================================================
    # LOGS
    # ==============================================================================
    
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    
</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
