# üöÄ Sistema de Gesti√≥n de Empleados - CRUD PHP-MySQL con Docker

Sistema completo de gesti√≥n CRUD (Create, Read, Update, Delete) desarrollado con PHP y MySQL, implementado con Docker, Apache, SSL/HTTPS, mod_rewrite y an√°lisis de logs con GoAccess.

## üìã Tabla de Contenidos

- [Caracter√≠sticas](#caracter√≠sticas)
- [Tecnolog√≠as Utilizadas](#tecnolog√≠as-utilizadas)
- [Requisitos Previos](#requisitos-previos)
- [Instalaci√≥n](#instalaci√≥n)
- [Uso](#uso)
- [Arquitectura del Proyecto](#arquitectura-del-proyecto)
- [Caracter√≠sticas T√©cnicas Implementadas](#caracter√≠sticas-t√©cnicas-implementadas)
- [Capturas de Pantalla](#capturas-de-pantalla)
- [Soluci√≥n de Problemas](#soluci√≥n-de-problemas)
- [Cr√©ditos](#cr√©ditos)

## ‚ú® Caracter√≠sticas

- ‚úÖ **CRUD Completo**: Crear, leer, actualizar y eliminar empleados
- ‚úÖ **Dockerizado**: F√°cil despliegue y portabilidad
- ‚úÖ **SSL/HTTPS**: Comunicaciones seguras con certificados autofirmados
- ‚úÖ **mod_rewrite**: URLs limpias y amigables
- ‚úÖ **GoAccess**: An√°lisis de logs en tiempo real
- ‚úÖ **Dise√±o Responsive**: Bootstrap 5 con interfaz moderna
- ‚úÖ **Base de Datos**: MySQL 8.0 con datos de ejemplo
- ‚úÖ **phpMyAdmin**: Gesti√≥n visual de la base de datos
- ‚úÖ **Seguridad**: Headers de seguridad, validaci√≥n de datos, prepared statements

## üõ† Tecnolog√≠as Utilizadas

### Backend
- **PHP 8.2**: Lenguaje de programaci√≥n del lado del servidor
- **MySQL 8.0**: Sistema de gesti√≥n de bases de datos
- **Apache 2.4**: Servidor web con m√≥dulos SSL y Rewrite

### Frontend
- **HTML5 & CSS3**: Estructura y estilos
- **Bootstrap 5.3**: Framework CSS responsive
- **Bootstrap Icons**: Iconograf√≠a moderna

### DevOps
- **Docker**: Contenedorizaci√≥n de la aplicaci√≥n
- **Docker Compose**: Orquestaci√≥n de contenedores

### Herramientas
- **GoAccess**: An√°lisis de logs en tiempo real
- **phpMyAdmin**: Gesti√≥n visual de MySQL
- **OpenSSL**: Generaci√≥n de certificados SSL

## üì¶ Requisitos Previos

- **Docker**: versi√≥n 20.10 o superior
- **Docker Compose**: versi√≥n 2.0 o superior
- **Git**: Para clonar el repositorio
- **Navegador web moderno**: Chrome, Firefox, Safari o Edge

### Verificar instalaci√≥n de Docker

```bash
docker --version
docker-compose --version
```

## üöÄ Instalaci√≥n

### 1. Clonar el repositorio

```bash
cd /tmp
# El proyecto ya est√° en /tmp/php-crud-docker/
```

### 2. Estructura del proyecto

```
php-crud-docker/
‚îú‚îÄ‚îÄ docker-compose.yml          # Orquestaci√≥n de contenedores
‚îú‚îÄ‚îÄ Dockerfile                  # Imagen personalizada de Apache+PHP
‚îú‚îÄ‚îÄ docker-entrypoint.sh        # Script de inicializaci√≥n
‚îú‚îÄ‚îÄ init.sql                    # Script de inicializaci√≥n de BD
‚îú‚îÄ‚îÄ .env.example                # Plantilla de variables de entorno
‚îú‚îÄ‚îÄ .gitignore                  # Archivos ignorados por Git
‚îú‚îÄ‚îÄ README.md                   # Esta documentaci√≥n
‚îÇ
‚îú‚îÄ‚îÄ apache-config/              # Configuraci√≥n de Apache
‚îÇ   ‚îú‚îÄ‚îÄ 000-default.conf        # VirtualHost HTTP (redirige a HTTPS)
‚îÇ   ‚îî‚îÄ‚îÄ default-ssl.conf        # VirtualHost HTTPS
‚îÇ
‚îú‚îÄ‚îÄ src/                        # C√≥digo fuente de la aplicaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ index.php               # P√°gina principal (listado)
‚îÇ   ‚îú‚îÄ‚îÄ create.php              # Crear empleado
‚îÇ   ‚îú‚îÄ‚îÄ read.php                # Ver detalles de empleado
‚îÇ   ‚îú‚îÄ‚îÄ update.php              # Actualizar empleado
‚îÇ   ‚îú‚îÄ‚îÄ delete.php              # Eliminar empleado
‚îÇ   ‚îú‚îÄ‚îÄ config.php              # Configuraci√≥n de BD
‚îÇ   ‚îú‚îÄ‚îÄ error.php               # P√°gina de error
‚îÇ   ‚îú‚îÄ‚îÄ analytics.php           # Visor de estad√≠sticas GoAccess
‚îÇ   ‚îú‚îÄ‚îÄ .htaccess               # Reglas de mod_rewrite
‚îÇ   ‚îî‚îÄ‚îÄ goaccess/               # Reportes de GoAccess
‚îÇ
‚îú‚îÄ‚îÄ ssl/                        # Certificados SSL (generados autom√°ticamente)
‚îî‚îÄ‚îÄ logs/                       # Logs de Apache (persistentes)
```

### 3. Construir y ejecutar los contenedores

```bash
cd /tmp/php-crud-docker

# Construir y levantar los contenedores
docker-compose up -d --build
```

Este comando:
- Descarga las im√°genes base necesarias
- Construye la imagen personalizada de Apache+PHP
- Genera certificados SSL autofirmados
- Crea los contenedores (web, db, phpmyadmin)
- Inicializa la base de datos con datos de ejemplo
- Inicia GoAccess para an√°lisis de logs

### 4. Verificar que los contenedores est√°n corriendo

```bash
docker-compose ps
```

Deber√≠as ver 3 contenedores activos:
- `php-apache-crud` (Web server)
- `mysql-crud` (Base de datos)
- `phpmyadmin-crud` (Gestor visual de BD)

## üéØ Uso

### Acceso a la Aplicaci√≥n

Una vez los contenedores est√©n corriendo, puedes acceder a:

| Servicio | URL | Descripci√≥n |
|----------|-----|-------------|
| **Aplicaci√≥n Principal** | https://localhost | Sistema CRUD de empleados (con SSL) |
| **HTTP (Redirige a HTTPS)** | http://localhost | Redirecci√≥n autom√°tica a HTTPS |
| **phpMyAdmin** | http://localhost:8080 | Gesti√≥n visual de MySQL |
| **GoAccess Analytics** | https://localhost/analytics.php | An√°lisis de logs en tiempo real |
| **GoAccess WebSocket** | ws://localhost:7890 | WebSocket para actualizaci√≥n en tiempo real |

### Credenciales de Base de Datos

**MySQL (para phpMyAdmin)**
- Usuario: `root`
- Contrase√±a: `rootpassword`
- Base de datos: `crud_db`

**Usuario de aplicaci√≥n**
- Usuario: `crud_user`
- Contrase√±a: `crud_password`
- Base de datos: `crud_db`

### Funcionalidades de la Aplicaci√≥n

#### 1. **Listar Empleados** (index.php)
- Ver todos los empleados en formato tabla
- Contador de empleados totales
- Acciones r√°pidas: Ver, Editar, Eliminar

#### 2. **Crear Empleado** (create.php)
- Formulario con validaci√≥n
- Campos: Nombre, Direcci√≥n, Salario
- Validaci√≥n del lado del servidor

#### 3. **Ver Empleado** (read.php)
- Vista detallada de un empleado espec√≠fico
- Formato de visualizaci√≥n limpio

#### 4. **Actualizar Empleado** (update.php)
- Formulario pre-rellenado con datos actuales
- Validaci√≥n de datos
- Confirmaci√≥n de actualizaci√≥n

#### 5. **Eliminar Empleado** (delete.php)
- Confirmaci√≥n antes de eliminar
- Eliminaci√≥n segura con prepared statements

### URLs Amigables (mod_rewrite)

El sistema implementa URLs limpias gracias a mod_rewrite:

| URL Tradicional | URL Limpia |
|----------------|------------|
| `read.php?id=5` | `/empleado/5` |
| `update.php?id=5` | `/editar/5` |
| `delete.php?id=5` | `/eliminar/5` |
| `create.php` | `/nuevo` |
| `index.php` | `/empleados` |

## üèó Arquitectura del Proyecto

### Contenedores Docker

```mermaid
graph TB
    A[Cliente/Navegador] -->|HTTPS:443/HTTP:80| B[php-apache-crud]
    A -->|HTTP:8080| C[phpmyadmin-crud]
    B -->|MySQL| D[mysql-crud]
    C -->|MySQL| D
    B -->|Logs| E[GoAccess]
    
    style A fill:#667eea
    style B fill:#28a745
    style C fill:#ffc107
    style D fill:#dc3545
    style E fill:#17a2b8
```

### Flujo de Datos

1. **Cliente** realiza petici√≥n HTTP/HTTPS
2. **Apache** recibe la petici√≥n y aplica reglas de rewrite
3. **PHP** procesa la l√≥gica de negocio
4. **MySQL** almacena/recupera datos
5. **GoAccess** analiza logs en tiempo real
6. **Respuesta** se env√≠a al cliente

## üîß Caracter√≠sticas T√©cnicas Implementadas

### 0Ô∏è‚É£ Docker (Requisito 0)

#### Dockerfile
- Imagen base: `php:8.2-apache`
- Extensiones PHP: `gd`, `mysqli`, `pdo`, `pdo_mysql`
- Herramientas: `goaccess`, `vim`, `git`, `openssl`
- Certificados SSL autofirmados generados autom√°ticamente
- M√≥dulos Apache habilitados: `rewrite`, `ssl`, `headers`

#### docker-compose.yml
- **Servicio Web**: Apache + PHP con vol√∫menes persistentes
- **Servicio DB**: MySQL 8.0 con inicializaci√≥n autom√°tica
- **Servicio phpMyAdmin**: Gesti√≥n visual de base de datos
- **Red personalizada**: Comunicaci√≥n entre contenedores
- **Vol√∫menes**: Persistencia de datos y logs

### 1Ô∏è‚É£ mod_rewrite (Requisito 1)

**Ubicaci√≥n**: `src/.htaccess`

**Funcionalidades implementadas**:

1. **URLs Limpias**:
   ```apache
   RewriteRule ^empleado/([0-9]+)$ read.php?id=$1 [L,QSA]
   RewriteRule ^editar/([0-9]+)$ update.php?id=$1 [L,QSA]
   ```

2. **Seguridad**:
   - Bloqueo de acceso a `config.php`
   - Desactivaci√≥n de listado de directorios
   - Redirecci√≥n forzada a HTTPS

3. **Optimizaci√≥n**:
   - Compresi√≥n de contenido (mod_deflate)
   - Cach√© del navegador (mod_expires)
   - Headers de seguridad

### 5Ô∏è‚É£ SSL/HTTPS (Requisito 5)

#### Certificados Autofirmados

Generaci√≥n autom√°tica en el Dockerfile:

```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout /etc/ssl/private/apache-selfsigned.key \
    -out /etc/ssl/private/apache-selfsigned.crt \
    -subj "/C=ES/ST=Madrid/L=Madrid/O=Universidad/OU=IT/CN=localhost"
```

#### Configuraci√≥n Apache

**VirtualHost HTTP** (`000-default.conf`):
- Puerto 80
- Redirecci√≥n autom√°tica a HTTPS
- C√≥digo de estado 301 (permanente)

**VirtualHost HTTPS** (`default-ssl.conf`):
- Puerto 443
- SSLEngine activado
- Protocolos: TLS 1.2+
- Cifrados seguros
- Headers de seguridad (HSTS, X-Frame-Options, etc.)

#### Headers de Seguridad Implementados

```apache
Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains"
Header always set X-Frame-Options DENY
Header always set X-Content-Type-Options nosniff
Header set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
```

### 8Ô∏è‚É£ GoAccess - An√°lisis de Logs (Requisito 8)

#### Instalaci√≥n y Configuraci√≥n

**Instalado en Dockerfile**:
```dockerfile
RUN apt-get install -y goaccess
```

**Script de inicio** (`docker-entrypoint.sh`):
```bash
goaccess /var/log/apache2/access.log \
    --log-format=COMBINED \
    --real-time-html \
    --ws-url=ws://localhost:7890 \
    --port=7890 \
    --output=/var/www/html/goaccess/report.html \
    --daemonize
```

#### Caracter√≠sticas de GoAccess

- **An√°lisis en tiempo real**: WebSocket en puerto 7890
- **Formato HTML**: Interfaz web interactiva
- **M√©tricas incluidas**:
  - Visitantes √∫nicos
  - P√°ginas m√°s visitadas
  - Sistemas operativos
  - Navegadores
  - C√≥digos de estado HTTP
  - Ancho de banda
  - Referrers
  - IPs de visitantes

#### Acceso a Estad√≠sticas

1. **Directo**: https://localhost/goaccess/report.html
2. **Viewer integrado**: https://localhost/analytics.php

### 6Ô∏è‚É£ Documentaci√≥n (Requisito 6)

‚úÖ **README.md completo** con:
- Descripci√≥n del proyecto
- Instrucciones de instalaci√≥n detalladas
- Gu√≠a de uso
- Arquitectura del sistema
- Explicaci√≥n t√©cnica de cada componente
- Soluci√≥n de problemas
- Capturas de pantalla

‚úÖ **Comentarios en c√≥digo**:
- Todos los archivos PHP comentados
- Archivos de configuraci√≥n documentados
- Docker y scripts explicados

‚úÖ **Estructura clara**:
- Organizaci√≥n l√≥gica de directorios
- Nombres descriptivos de archivos
- Separaci√≥n de concerns

## üîí Seguridad Implementada

### 1. Validaci√≥n de Datos
- Validaci√≥n del lado del servidor
- Expresiones regulares para nombres
- Validaci√≥n num√©rica para salarios
- Sanitizaci√≥n de entradas

### 2. Prepared Statements
- Todas las consultas SQL usan prepared statements
- Protecci√≥n contra SQL Injection
- Binding de par√°metros tipados

### 3. Headers de Seguridad
- HSTS (HTTP Strict Transport Security)
- X-Frame-Options (previene clickjacking)
- X-Content-Type-Options (previene MIME sniffing)
- X-XSS-Protection
- Referrer-Policy

### 4. Protecci√≥n de Archivos
- `.htaccess` bloquea acceso a `config.php`
- Desactivaci√≥n de listado de directorios
- Variables de entorno para credenciales

### 5. Comunicaciones Encriptadas
- Todo el tr√°fico redirigido a HTTPS
- Certificados SSL/TLS
- Protocolos seguros (TLS 1.2+)

## üìä Base de Datos

### Estructura de la Tabla `employees`

```sql
CREATE TABLE employees (
    id INT(11) NOT NULL AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    address VARCHAR(255) NOT NULL,
    salary DECIMAL(10, 2) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (id)
);
```

### Datos de Ejemplo

El sistema incluye 5 empleados de ejemplo:
- Juan P√©rez - Madrid - 35,000‚Ç¨
- Mar√≠a Garc√≠a - Barcelona - 42,000‚Ç¨
- Carlos L√≥pez - Valencia - 38,000‚Ç¨
- Ana Mart√≠nez - Madrid - 45,000‚Ç¨
- Luis Rodr√≠guez - Madrid - 40,000‚Ç¨

## üì∏ Capturas de Pantalla

### P√°gina Principal
![P√°gina Principal](docs/screenshots/index.png)

### Crear Empleado
![Crear Empleado](docs/screenshots/create.png)

### Estad√≠sticas GoAccess
![GoAccess](docs/screenshots/goaccess.png)

### phpMyAdmin
![phpMyAdmin](docs/screenshots/phpmyadmin.png)

## üêõ Soluci√≥n de Problemas

### Problema: "Warning: Self-signed certificate"

**Soluci√≥n**: Los certificados son autofirmados para desarrollo. En tu navegador:
- Chrome: Clic en "Avanzado" ‚Üí "Ir a localhost (no seguro)"
- Firefox: "Avanzado" ‚Üí "Aceptar el riesgo y continuar"

Para producci√≥n, usa certificados de Let's Encrypt.

### Problema: "Connection refused" al acceder a la aplicaci√≥n

**Soluci√≥n**:
```bash
# Verificar estado de contenedores
docker-compose ps

# Ver logs
docker-compose logs web

# Reiniciar contenedores
docker-compose restart
```

### Problema: Error de conexi√≥n a MySQL

**Soluci√≥n**:
```bash
# Esperar a que MySQL termine de inicializar
docker-compose logs db

# Verificar conectividad
docker exec -it php-apache-crud ping db
```

### Problema: GoAccess no muestra datos

**Soluci√≥n**:
```bash
# Verificar que el script se est√° ejecutando
docker exec -it php-apache-crud ps aux | grep goaccess

# Reiniciar el contenedor
docker-compose restart web

# Generar tr√°fico visitando varias p√°ginas
```

### Problema: mod_rewrite no funciona

**Soluci√≥n**:
```bash
# Verificar que el m√≥dulo est√° habilitado
docker exec -it php-apache-crud apache2ctl -M | grep rewrite

# Verificar configuraci√≥n de .htaccess
docker exec -it php-apache-crud cat /var/www/html/.htaccess

# Reiniciar Apache
docker-compose restart web
```

## üõë Detener y Limpiar

### Detener contenedores

```bash
docker-compose stop
```

### Detener y eliminar contenedores

```bash
docker-compose down
```

### Eliminar todo (contenedores, vol√∫menes, im√°genes)

```bash
docker-compose down -v --rmi all
```

## üìù Comandos √ötiles

### Ver logs en tiempo real

```bash
# Todos los servicios
docker-compose logs -f

# Solo web
docker-compose logs -f web

# Solo base de datos
docker-compose logs -f db
```

### Acceder al contenedor

```bash
# Contenedor web
docker exec -it php-apache-crud bash

# Contenedor MySQL
docker exec -it mysql-crud bash
```

### Ejecutar consultas SQL directamente

```bash
docker exec -it mysql-crud mysql -u root -prootpassword crud_db
```

### Ver logs de Apache

```bash
# Access log
docker exec -it php-apache-crud tail -f /var/log/apache2/access.log

# Error log
docker exec -it php-apache-crud tail -f /var/log/apache2/error.log
```

### Backup de la base de datos

```bash
docker exec mysql-crud mysqldump -u root -prootpassword crud_db > backup.sql
```

### Restaurar base de datos

```bash
docker exec -i mysql-crud mysql -u root -prootpassword crud_db < backup.sql
```

## üöÄ Despliegue en Producci√≥n

### Recomendaciones

1. **Cambiar contrase√±as**: Actualizar todas las contrase√±as en `docker-compose.yml`
2. **Certificados reales**: Usar Let's Encrypt en lugar de autofirmados
3. **Variables de entorno**: Usar archivo `.env` para credenciales
4. **Proxy reverso**: Implementar Nginx como proxy reverso
5. **Firewall**: Configurar reglas de firewall (UFW, iptables)
6. **Backups autom√°ticos**: Script de backup diario de la BD
7. **Monitoring**: Implementar Prometheus + Grafana
8. **Logs**: Enviar logs a servicio centralizado (ELK Stack)

### Ejemplo con Let's Encrypt

```bash
# Instalar Certbot
apt-get install certbot python3-certbot-apache

# Obtener certificado
certbot --apache -d tudominio.com

# Renovaci√≥n autom√°tica
certbot renew --dry-run
```

## üìö Recursos y Referencias

### Documentaci√≥n Oficial
- [PHP Manual](https://www.php.net/manual/es/)
- [MySQL Documentation](https://dev.mysql.com/doc/)
- [Apache HTTP Server](https://httpd.apache.org/docs/)
- [Docker Documentation](https://docs.docker.com/)
- [GoAccess](https://goaccess.io/)

### Tutoriales
- [Tutorial base CRUD PHP-MySQL](https://www.tutorialrepublic.com/php-tutorial/php-mysql-crud-application.php)
- [mod_rewrite Guide](https://httpd.apache.org/docs/current/mod/mod_rewrite.html)
- [SSL/TLS Best Practices](https://wiki.mozilla.org/Security/Server_Side_TLS)

## üë®‚Äçüíª Autor

Proyecto desarrollado para actividad de clase.

## üìÑ Licencia

Este proyecto es de c√≥digo abierto y est√° disponible bajo la licencia MIT.

## üéì Actividad de Clase - Entregables

### ‚úÖ Requisitos Cumplidos

- [x] **0. Montarlo en Docker**: Dockerfile + docker-compose.yml completos
- [x] **1. Uso de m√≥dulos (mod_rewrite)**: Configurado con URLs limpias
- [x] **5. SSL/HTTPS**: Certificados autofirmados + redirecci√≥n autom√°tica
- [x] **8. Gesti√≥n y an√°lisis de logs (GoAccess)**: An√°lisis en tiempo real
- [x] **6. Elaboraci√≥n de documentaci√≥n**: README completo con gu√≠as

### üìπ Para el V√≠deo

**Demostraci√≥n sugerida**:

1. **Introducci√≥n** (30 seg)
   - Explicar el proyecto y tecnolog√≠as

2. **Levantar el proyecto** (1 min)
   - `docker-compose up -d --build`
   - Mostrar contenedores corriendo

3. **Demostraci√≥n CRUD** (2 min)
   - Listar empleados
   - Crear nuevo empleado
   - Editar empleado existente
   - Ver detalles
   - Eliminar empleado

4. **mod_rewrite** (1 min)
   - Mostrar URLs limpias en acci√≥n
   - Mostrar archivo .htaccess

5. **SSL/HTTPS** (1 min)
   - Mostrar redirecci√≥n de HTTP a HTTPS
   - Mostrar certificado en navegador
   - Explicar configuraci√≥n

6. **GoAccess** (1 min)
   - Acceder a analytics.php
   - Mostrar m√©tricas en tiempo real
   - Explicar informaci√≥n mostrada

7. **phpMyAdmin** (30 seg)
   - Mostrar base de datos
   - Mostrar tabla employees

8. **Conclusi√≥n** (30 seg)
   - Resumen de caracter√≠sticas
   - Comandos √∫tiles

**Duraci√≥n total**: ~8 minutos

## üéØ Mejoras Futuras

- [ ] Sistema de autenticaci√≥n de usuarios
- [ ] API REST para integraci√≥n con otros sistemas
- [ ] Export/Import de datos (CSV, Excel)
- [ ] B√∫squeda avanzada y filtros
- [ ] Paginaci√≥n para grandes vol√∫menes de datos
- [ ] Sistema de roles y permisos
- [ ] Dashboard con gr√°ficos estad√≠sticos
- [ ] Env√≠o de notificaciones por email
- [ ] Integraci√≥n con sistemas de CI/CD
- [ ] Tests automatizados (PHPUnit)

---

**¬°Proyecto completo y listo para usar!** üéâ

Si tienes alguna pregunta o problema, consulta la secci√≥n de [Soluci√≥n de Problemas](#soluci√≥n-de-problemas) o revisa los logs con `docker-compose logs`.
